Протокол поддерживает т.н. **контроль потока**, позволяющий обрабатывать различные ситуации.

> [!quote]
> Опция включена по умолчанию.

##### Получение пакетов в неправильном порядке
При включенной опции контроля потока пакеты, пришедшие с опозданием, будут отброшены. 

Например, если было отправлено 3 пакета - `P1`, `P2`, `P3`, которые пришли в порядке `P3`, `P2`, `P1`, то обработан будет только пакет `P3`, а остальные будут отброшены с ошибкой [[Обработка ошибок#Out-of-order packet|RUAVP_ERROR_OUT_OF_ORDER_PACKET]].

##### Получение дубликата пакета
При получении дубликата пакет будет отброшен с ошибкой [[Обработка ошибок#Duplicated packet|RUAVP_ERROR_OUT_DUP_PACKET]].

#### Принцип работы системы
Система работает на основе кодирования в пакет уникального идентификатора - `sid` ([[Session ID]]). 
#### Подсчет пакетов
```c
struct ruavp_control_t
{
  int direct_counter;
  int multicast_counter;
  int good_packets;
  int lost_packets;
  int ooo_packets;
  int dup_packets;
  uint16_t sid;
};
```

В структуре `ruavp_protocol_t` содержится массив структур `ruavp_control_t` по количеству устройств в системе. Для каждого устройства ведутся следующие счётчики:
- `direct_counter` - количество принятых "прямых" пакетов.
- `multicast_counter` - количество принятых мультикаст-пакетов.
- `good_packets` - общее количество "хороших" (т.е. валидных) пакетов в системе.
- `lost_packets` - количество потерянных пакетов.
- `ooo_packets` - количество пакетов, пришедших в неверном порядке.
- `dup_packets` - количество пакетов-дубликатов.
- `sid` - текущий идентификатор сессии.

> [!note]
> Приход пакета в неверном порядке, равно как и приход дубликата, не всегда является незапланированным поведением. Если отправитель отправляет пакеты по нескольким физическим каналам связи, либо посылает пакеты несколько раз в целях увеличения вероятности доставки пакета по радиоканалу (так, например, делает [[Протокол XProto]], работающий поверх протокола Ruavp), ошибки будут возникать в валидной ситуации.



